Hi, actually I already faced with this task 2 years ago. 
So this task a little bit cheat from my side. 
It was implemented in Java and performance was awful as I can remember. 
Now I guess it is good enough. 
But anyway it's all about data structure that was picked before.
